<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>災害救助行動指揮系統 v3.0 - 專業實戰版</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React, ReactDOM & Babel -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Chart.js (預留未來擴充) -->
    
    <style>
        /* 基礎設定 */
        :root {
            --primary: #2563eb;
            --danger: #dc2626;
            --success: #16a34a;
            --warning: #ca8a04;
        }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; }
        
        /* 滾動條優化 */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }
        
        /* 特效類 */
        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(226, 232, 240, 0.8);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .login-pattern {
            background-color: #f8fafc;
            background-image: linear-gradient(135deg, #e2e8f0 25%, transparent 25%), linear-gradient(225deg, #e2e8f0 25%, transparent 25%), linear-gradient(45deg, #e2e8f0 25%, transparent 25%), linear-gradient(315deg, #e2e8f0 25%, transparent 25%);
            background-position:  10px 0, 10px 0, 0 0, 0 0;
            background-size: 20px 20px;
            background-repeat: repeat;
        }
        .map-bg {
            background-image: url('https://api.mapbox.com/styles/v1/mapbox/light-v11/static/121.5,24.0,9/1200x800?access_token=none');
            background-size: cover;
            background-position: center;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 overflow-hidden">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- 模擬數據資料庫 ---
        const INITIAL_INCIDENTS = [
            { id: 'inc-1', name: '花蓮 0403 地震專案', level: '2級 (縣市)', status: '執行中', date: '2024-04-03', commander: '林局長' },
            { id: 'inc-2', name: '南投土石流預警專案', level: '1級 (鄉鎮)', status: '準備中', date: '2024-05-12', commander: '陳區長' },
        ];

        const ROLES = [
            { id: 'ic', name: '指揮官 (IC)', icon: 'shield-check', color: 'bg-red-600', desc: '全權指揮、決策下達' },
            { id: 'ops', name: '作業組 (Ops)', icon: 'activity', color: 'bg-blue-600', desc: '搜救、醫療、工程' },
            { id: 'log', name: '後勤組 (Log)', icon: 'package', color: 'bg-orange-500', desc: '物資、運輸、通訊' },
            { id: 'fin', name: '財務組 (Fin)', icon: 'dollar-sign', color: 'bg-emerald-600', desc: '採購、捐款、核銷' },
            { id: 'vol', name: '志工隊 (Vol)', icon: 'users', color: 'bg-slate-600', desc: '人力支援、民眾服務' },
        ];

        // --- 組件: 通用 Modal ---
        const Modal = ({ isOpen, onClose, title, children }) => {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/40 backdrop-blur-sm animate-in fade-in duration-200">
                    <div className="bg-white border border-slate-200 rounded-2xl w-full max-w-lg overflow-hidden shadow-2xl scale-100 animate-in zoom-in-95 duration-200">
                        <div className="px-6 py-4 border-b border-slate-100 flex justify-between items-center bg-slate-50/50">
                            <h3 className="font-bold text-lg text-slate-800 flex items-center gap-2">
                                <span className="w-1 h-6 bg-blue-600 rounded-full"></span>
                                {title}
                            </h3>
                            <button onClick={onClose} className="p-1 hover:bg-slate-200 rounded-full transition-colors text-slate-500">
                                <i data-lucide="x" width="20"></i>
                            </button>
                        </div>
                        <div className="p-6 max-h-[80vh] overflow-y-auto">{children}</div>
                    </div>
                </div>
            );
        };

        // --- 組件: 狀態標籤 ---
        const StatusBadge = ({ status, type = 'default' }) => {
            const colors = {
                '逾時': 'bg-red-100 text-red-700 border-red-200',
                '已報到': 'bg-green-100 text-green-700 border-green-200',
                '預約中': 'bg-blue-50 text-blue-600 border-blue-200',
                '執行中': 'bg-blue-600 text-white border-blue-600',
                '緊急': 'bg-red-600 text-white border-red-600',
                '查證中': 'bg-orange-100 text-orange-700 border-orange-200',
                '已澄清': 'bg-emerald-100 text-emerald-700 border-emerald-200',
                '待處理': 'bg-slate-100 text-slate-600 border-slate-200',
            };
            const style = colors[status] || 'bg-slate-100 text-slate-600 border-slate-200';
            return (
                <span className={`px-2.5 py-0.5 rounded-full text-[10px] font-bold border ${style} shadow-sm whitespace-nowrap`}>
                    {status}
                </span>
            );
        };

        // --- 登入畫面 ---
        const LoginView = ({ onLogin }) => {
            useEffect(() => { lucide.createIcons(); }, []);
            return (
                <div className="h-screen w-full flex items-center justify-center login-pattern p-4">
                    <div className="max-w-5xl w-full grid grid-cols-1 lg:grid-cols-5 bg-white rounded-[2rem] shadow-2xl overflow-hidden border border-slate-200 min-h-[600px]">
                        
                        {/* 左側資訊區 */}
                        <div className="lg:col-span-2 bg-slate-900 text-white p-10 flex flex-col justify-between relative overflow-hidden">
                            <div className="absolute inset-0 opacity-20 bg-[url('https://images.unsplash.com/photo-1454165804606-c3d57bc86b40?q=80&w=1000&auto=format&fit=crop')] bg-cover bg-center mix-blend-overlay"></div>
                            <div className="relative z-10">
                                <div className="w-14 h-14 bg-red-600 rounded-2xl flex items-center justify-center shadow-lg mb-6">
                                    <i data-lucide="shield-alert" class="text-white w-8 h-8"></i>
                                </div>
                                <h1 className="text-3xl font-black mb-2 tracking-tight">救災指揮系統 <span class="text-red-500">v3.0</span></h1>
                                <p className="text-slate-400 text-sm font-medium">Disaster Relief Command System</p>
                            </div>
                            <div className="relative z-10 space-y-4">
                                <div className="bg-slate-800/50 p-4 rounded-xl border border-slate-700 backdrop-blur-sm">
                                    <div className="text-xs text-slate-400 uppercase tracking-wider font-bold mb-1">系統狀態</div>
                                    <div className="flex items-center gap-2 text-green-400 font-bold text-sm">
                                        <span className="relative flex h-3 w-3">
                                          <span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                                          <span className="relative inline-flex rounded-full h-3 w-3 bg-green-500"></span>
                                        </span>
                                        全線正常運作
                                    </div>
                                </div>
                                <p className="text-xs text-slate-500 leading-relaxed">
                                    本系統符合 ISO 22320 應變管理標準。請選擇授權身份進行登入，所有操作皆會被稽核記錄。
                                </p>
                            </div>
                        </div>

                        {/* 右側登入區 */}
                        <div className="lg:col-span-3 p-10 flex flex-col justify-center bg-white">
                            <h2 className="text-2xl font-bold text-slate-800 mb-6 flex items-center gap-2">
                                請選擇登入身份
                                <span className="text-xs font-normal text-slate-400 bg-slate-100 px-2 py-1 rounded-full">SAML 2.0 驗證</span>
                            </h2>
                            <div className="grid grid-cols-1 gap-3">
                                {ROLES.map(role => (
                                    <button 
                                        key={role.id}
                                        onClick={() => onLogin(role)}
                                        className="group relative flex items-center gap-4 p-4 rounded-xl border border-slate-200 bg-white hover:border-blue-500 hover:shadow-md transition-all text-left"
                                    >
                                        <div className={`w-12 h-12 rounded-lg flex items-center justify-center text-white shadow-sm transition-transform group-hover:scale-105 ${role.color}`}>
                                            <i data-lucide={role.icon}></i>
                                        </div>
                                        <div>
                                            <p className="font-bold text-slate-800 text-base">{role.name}</p>
                                            <p className="text-xs text-slate-500">{role.desc}</p>
                                        </div>
                                        <div className="absolute right-4 opacity-0 group-hover:opacity-100 transition-opacity text-blue-500">
                                            <i data-lucide="arrow-right"></i>
                                        </div>
                                    </button>
                                ))}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- 主應用程式 ---
        const App = () => {
            const [currentUser, setCurrentUser] = useState(null);
            const [activeTab, setActiveTab] = useState('map');
            const [activeIncidentId, setActiveIncidentId] = useState('inc-1');
            const [incidents, setIncidents] = useState(INITIAL_INCIDENTS);
            const [searchTerm, setSearchTerm] = useState('');
            
            // 模擬數據狀態
            const [reservations, setReservations] = useState([
                { id: 1, name: '王小明', phone: '0912-345-678', skill: 'USAR 搜索', time: new Date().toISOString(), status: '逾時' },
                { id: 2, name: '陳美麗', phone: '0922-111-222', skill: '護理師', time: new Date().toISOString(), status: '預約中' },
            ]);
            const [requests, setRequests] = useState([
                { id: 1, item: '發電機 5KW', qty: 2, from: '前進指揮所', status: '待處理', priority: '緊急' },
                { id: 2, item: '礦泉水', qty: 50, from: '體育館安置點', status: '運送中', priority: '普通' },
            ]);
            
            const [isModalOpen, setIsModalOpen] = useState(false);
            const [modalType, setModalType] = useState(null);

            // 效果: Lucide Icons 渲染
            useEffect(() => { lucide.createIcons(); }, [currentUser, activeTab, isModalOpen]);

            if (!currentUser) return <LoginView onLogin={setCurrentUser} />;

            const activeIncident = incidents.find(i => i.id === activeIncidentId);

            // CRUD 操作模擬
            const handleUpdateStatus = (list, setList, id, newStatus) => {
                setList(list.map(item => item.id === id ? { ...item, status: newStatus } : item));
            };

            const handleDelete = (list, setList, id) => {
                if(confirm('確定要刪除此項目嗎？')) {
                    setList(list.filter(item => item.id !== id));
                }
            };

            const handleAddItem = (e) => {
                e.preventDefault();
                const fd = new FormData(e.target);
                // 這裡簡化處理，根據 modalType 新增到對應 state
                if(modalType === 'volunteer') {
                    setReservations([...reservations, { 
                        id: Date.now(), 
                        name: fd.get('name'), 
                        phone: fd.get('phone'), 
                        skill: fd.get('skill'), 
                        time: new Date().toISOString(), 
                        status: '預約中' 
                    }]);
                }
                if(modalType === 'logistics') {
                    setRequests([...requests, {
                        id: Date.now(),
                        item: fd.get('item'),
                        qty: fd.get('qty'),
                        from: fd.get('from'),
                        status: '待處理',
                        priority: fd.get('priority')
                    }]);
                }
                setIsModalOpen(false);
            };

            // 渲染內容區塊
            const renderContent = () => {
                // 通用頂部 (標題 + 搜尋 + 新增)
                const PageHeader = ({ title, icon, color, btnText, type }) => (
                    <div className="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
                        <div className="flex items-center gap-3">
                            <div className={`p-3 rounded-xl text-white shadow-md ${color}`}>
                                <i data-lucide={icon}></i>
                            </div>
                            <div>
                                <h2 className="text-2xl font-bold text-slate-800">{title}</h2>
                                <p className="text-xs text-slate-500 font-medium">即時數據同步中 • 最後更新: {new Date().toLocaleTimeString()}</p>
                            </div>
                        </div>
                        <div className="flex items-center gap-3 w-full md:w-auto">
                            <div className="relative flex-1 md:w-64">
                                <i data-lucide="search" className="absolute left-3 top-2.5 text-slate-400 w-4 h-4"></i>
                                <input 
                                    type="text" 
                                    placeholder="搜尋..." 
                                    className="w-full pl-9 pr-4 py-2 bg-white border border-slate-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 outline-none transition-all shadow-sm"
                                    onChange={(e) => setSearchTerm(e.target.value)}
                                />
                            </div>
                            <button 
                                onClick={() => { setModalType(type); setIsModalOpen(true); }}
                                className="px-4 py-2 bg-slate-900 hover:bg-slate-800 text-white rounded-lg text-sm font-bold flex items-center gap-2 shadow-lg hover:shadow-xl transition-all"
                            >
                                <i data-lucide="plus" width="16"></i> {btnText}
                            </button>
                        </div>
                    </div>
                );

                if (activeTab === 'map') {
                    return (
                        <div className="h-full flex flex-col relative overflow-hidden rounded-2xl border border-slate-200 shadow-inner bg-slate-100">
                            {/* 地圖背景 */}
                            <div className="absolute inset-0 map-bg opacity-60"></div>
                            
                            {/* 戰情儀表板 Overlay */}
                            <div className="absolute inset-0 p-6 flex flex-col pointer-events-none">
                                {/* 頂部數據卡 */}
                                <div className="grid grid-cols-1 md:grid-cols-4 gap-4 pointer-events-auto">
                                    {[
                                        { label: '目前投入人力', val: reservations.length + 120, unit: '人', icon: 'users', color: 'text-blue-600' },
                                        { label: '避難所負荷', val: '82', unit: '%', icon: 'home', color: 'text-orange-500' },
                                        { label: '待處理請求', val: requests.filter(r=>r.status==='待處理').length, unit: '件', icon: 'alert-circle', color: 'text-red-500' },
                                        { label: '已澄清謠言', val: '14', unit: '則', icon: 'shield-check', color: 'text-green-600' },
                                    ].map((stat, idx) => (
                                        <div key={idx} className="glass-panel p-4 rounded-xl flex items-center gap-4">
                                            <div className={`p-3 rounded-lg bg-slate-50 border border-slate-100 ${stat.color}`}>
                                                <i data-lucide={stat.icon}></i>
                                            </div>
                                            <div>
                                                <p className="text-xs text-slate-500 font-bold uppercase tracking-wider">{stat.label}</p>
                                                <p className="text-2xl font-black text-slate-800">{stat.val} <span className="text-xs text-slate-400 font-normal">{stat.unit}</span></p>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                                
                                {/* 側邊行動日誌 */}
                                <div className="mt-auto ml-auto w-80 glass-panel rounded-xl overflow-hidden pointer-events-auto max-h-[400px] flex flex-col">
                                    <div className="p-3 bg-slate-50 border-b border-slate-200 font-bold text-xs text-slate-600 flex justify-between">
                                        <span>即時行動日誌</span>
                                        <span className="text-blue-500 cursor-pointer hover:underline">匯出</span>
                                    </div>
                                    <div className="p-4 space-y-4 overflow-y-auto text-xs">
                                        <div className="flex gap-3">
                                            <span className="text-slate-400 font-mono">10:42</span>
                                            <div><span className="font-bold text-slate-700">指揮官</span> 發布了二級開設命令</div>
                                        </div>
                                        <div className="flex gap-3">
                                            <span className="text-slate-400 font-mono">10:38</span>
                                            <div><span className="font-bold text-slate-700">後勤組</span> 運送 50 箱水至體育館</div>
                                        </div>
                                        <div className="flex gap-3">
                                            <span className="text-slate-400 font-mono">10:15</span>
                                            <div className="text-red-600 font-bold">系統發布 CAP 警報：餘震注意</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    );
                }

                if (activeTab === 'volunteers') {
                    const filtered = reservations.filter(r => r.name.includes(searchTerm));
                    return (
                        <div className="max-w-6xl mx-auto animate-in fade-in slide-in-from-bottom-4 duration-300">
                            <PageHeader title="志工人力管理" icon="users" color="bg-blue-600" btnText="登錄志工" type="volunteer" />
                            
                            <div className="bg-white border border-slate-200 rounded-2xl shadow-sm overflow-hidden">
                                <table className="w-full text-sm text-left">
                                    <thead className="bg-slate-50 text-slate-500 font-bold uppercase text-xs border-b border-slate-200">
                                        <tr>
                                            <th className="px-6 py-4">姓名 / 聯絡</th>
                                            <th className="px-6 py-4">技能標籤</th>
                                            <th className="px-6 py-4">預計報到</th>
                                            <th className="px-6 py-4">狀態</th>
                                            <th className="px-6 py-4 text-right">操作</th>
                                        </tr>
                                    </thead>
                                    <tbody className="divide-y divide-slate-100">
                                        {filtered.map(res => (
                                            <tr key={res.id} className="hover:bg-slate-50 transition-colors group">
                                                <td className="px-6 py-4">
                                                    <div className="font-bold text-slate-800">{res.name}</div>
                                                    <div className="text-xs text-slate-400 font-mono">{res.phone}</div>
                                                </td>
                                                <td className="px-6 py-4">
                                                    <span className="px-2 py-1 bg-slate-100 text-slate-600 rounded text-xs border border-slate-200">{res.skill}</span>
                                                </td>
                                                <td className="px-6 py-4 text-slate-500 font-mono text-xs">
                                                    {new Date(res.time).toLocaleString()}
                                                </td>
                                                <td className="px-6 py-4">
                                                    <StatusBadge status={res.status} />
                                                </td>
                                                <td className="px-6 py-4 text-right">
                                                    <div className="flex justify-end gap-2 opacity-0 group-hover:opacity-100 transition-opacity">
                                                        {res.status !== '已報到' && (
                                                            <button 
                                                                onClick={() => handleUpdateStatus(reservations, setReservations, res.id, '已報到')}
                                                                className="px-2 py-1 bg-green-50 text-green-600 rounded border border-green-200 text-xs font-bold hover:bg-green-100"
                                                            >
                                                                簽到
                                                            </button>
                                                        )}
                                                        <button 
                                                            onClick={() => handleDelete(reservations, setReservations, res.id)}
                                                            className="p-1 text-slate-400 hover:text-red-500"
                                                        >
                                                            <i data-lucide="trash-2" width="16"></i>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    );
                }

                if (activeTab === 'logistics') {
                    const filtered = requests.filter(r => r.item.includes(searchTerm));
                    return (
                        <div className="max-w-6xl mx-auto animate-in fade-in slide-in-from-bottom-4 duration-300">
                            <PageHeader title="後勤資源調度" icon="package" color="bg-orange-500" btnText="提交需求" type="logistics" />
                            
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
                                {filtered.map(req => (
                                    <div key={req.id} className="bg-white border border-slate-200 rounded-xl p-5 shadow-sm hover:shadow-md transition-shadow relative overflow-hidden group">
                                        <div className={`absolute left-0 top-0 bottom-0 w-1 ${req.priority === '緊急' ? 'bg-red-500' : 'bg-slate-300'}`}></div>
                                        <div className="flex justify-between items-start mb-3 pl-2">
                                            <h4 className="font-bold text-slate-800 text-lg">{req.item}</h4>
                                            <StatusBadge status={req.priority} />
                                        </div>
                                        <div className="pl-2 space-y-2 text-sm text-slate-500">
                                            <div className="flex justify-between">
                                                <span>數量: <strong className="text-slate-800">{req.qty}</strong></span>
                                                <span>來自: {req.from}</span>
                                            </div>
                                            <div className="flex justify-between items-center pt-3 border-t border-slate-100">
                                                <span className="text-xs font-bold text-blue-600">{req.status}</span>
                                                <div className="flex gap-2">
                                                    {req.status === '待處理' && (
                                                        <button 
                                                            onClick={() => handleUpdateStatus(requests, setRequests, req.id, '運送中')}
                                                            className="px-3 py-1 bg-blue-600 text-white rounded text-xs font-bold hover:bg-blue-700"
                                                        >
                                                            核准
                                                        </button>
                                                    )}
                                                    {req.status === '運送中' && (
                                                        <button 
                                                            onClick={() => handleUpdateStatus(requests, setRequests, req.id, '已送達')}
                                                            className="px-3 py-1 bg-green-600 text-white rounded text-xs font-bold hover:bg-green-700"
                                                        >
                                                            簽收
                                                        </button>
                                                    )}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    );
                }

                // 其他模組可依此類推，為節省長度暫略
                return (
                    <div className="flex items-center justify-center h-full text-slate-400">
                        <div className="text-center">
                            <i data-lucide="wrench" width="48" class="mx-auto mb-4 opacity-50"></i>
                            <p>模組升級維護中...</p>
                        </div>
                    </div>
                );
            };

            return (
                <div className="flex h-screen bg-slate-50 text-slate-900 font-sans overflow-hidden">
                    {/* 側邊欄 */}
                    <nav className="w-64 bg-white border-r border-slate-200 flex flex-col z-20 shadow-xl">
                        <div className="p-5 border-b border-slate-100 flex items-center gap-3">
                            <div className="w-10 h-10 bg-red-600 rounded-lg flex items-center justify-center text-white shadow-lg shadow-red-100">
                                <i data-lucide="shield-check"></i>
                            </div>
                            <div>
                                <h1 className="font-bold text-slate-800 leading-none">救助指揮 v3.0</h1>
                                <span className="text-[10px] text-slate-400 font-bold uppercase tracking-widest">Pro Edition</span>
                            </div>
                        </div>

                        <div className="flex-1 py-6 px-3 space-y-1 overflow-y-auto">
                            <div className="px-4 mb-2 text-[10px] font-bold text-slate-400 uppercase tracking-widest">主要功能</div>
                            
                            <button onClick={() => setActiveTab('map')} className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all ${activeTab === 'map' ? 'bg-slate-900 text-white shadow-md' : 'text-slate-500 hover:bg-slate-50'}`}>
                                <i data-lucide="layout-dashboard" width="18"></i> <span className="font-bold text-sm">戰情儀表板</span>
                            </button>
                            <button onClick={() => setActiveTab('volunteers')} className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all ${activeTab === 'volunteers' ? 'bg-white text-blue-600 border border-blue-100 shadow-sm' : 'text-slate-500 hover:bg-slate-50'}`}>
                                <i data-lucide="users" width="18"></i> <span className="font-bold text-sm">志工人力</span>
                                <span className="ml-auto bg-blue-100 text-blue-600 py-0.5 px-2 rounded-full text-[10px] font-bold">{reservations.length}</span>
                            </button>
                            <button onClick={() => setActiveTab('logistics')} className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all ${activeTab === 'logistics' ? 'bg-white text-orange-600 border border-orange-100 shadow-sm' : 'text-slate-500 hover:bg-slate-50'}`}>
                                <i data-lucide="package" width="18"></i> <span className="font-bold text-sm">後勤調度</span>
                            </button>
                            
                            <div className="mt-6 px-4 mb-2 text-[10px] font-bold text-slate-400 uppercase tracking-widest">專案管理</div>
                            <div className="px-3">
                                <select 
                                    className="w-full bg-slate-50 border border-slate-200 text-xs p-2.5 rounded-lg outline-none focus:ring-2 focus:ring-blue-500 font-bold text-slate-700"
                                    value={activeIncidentId}
                                    onChange={(e) => setActiveIncidentId(e.target.value)}
                                >
                                    {incidents.map(inc => <option key={inc.id} value={inc.id}>{inc.name}</option>)}
                                </select>
                            </div>
                        </div>

                        {/* 底部使用者資訊 */}
                        <div className="p-4 border-t border-slate-100 bg-slate-50/50">
                            <div className="flex items-center gap-3">
                                <div className={`w-10 h-10 rounded-full flex items-center justify-center text-white shadow-md ${currentUser.color}`}>
                                    <span className="font-bold text-sm">{currentUser.name[0]}</span>
                                </div>
                                <div className="flex-1 overflow-hidden">
                                    <p className="font-bold text-sm text-slate-800 truncate">{currentUser.name}</p>
                                    <p className="text-xs text-slate-500 truncate">{activeIncident?.name}</p>
                                </div>
                                <button onClick={() => setCurrentUser(null)} className="p-2 text-slate-400 hover:text-red-500 transition-colors" title="登出">
                                    <i data-lucide="log-out" width="18"></i>
                                </button>
                            </div>
                        </div>
                    </nav>

                    {/* 主內容區 */}
                    <main className="flex-1 flex flex-col min-w-0 bg-white">
                        <header className="h-16 px-8 flex items-center justify-between border-b border-slate-100 bg-white/80 backdrop-blur-sm sticky top-0 z-10">
                            <div className="flex items-center gap-2">
                                <span className={`w-2 h-2 rounded-full ${activeIncident?.status === '執行中' ? 'bg-green-500 animate-pulse' : 'bg-yellow-500'}`}></span>
                                <span className="font-bold text-sm text-slate-700">{activeIncident?.level}開設</span>
                            </div>
                            <div className="flex items-center gap-4">
                                <button className="p-2 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded-full transition-all relative">
                                    <i data-lucide="bell" width="20"></i>
                                    <span className="absolute top-2 right-2 w-2 h-2 bg-red-500 rounded-full border-2 border-white"></span>
                                </button>
                                <div className="h-8 w-px bg-slate-200"></div>
                                <div className="text-right">
                                    <p className="text-xs font-bold text-slate-800">指揮官: {activeIncident?.commander}</p>
                                    <p className="text-[10px] text-slate-500 font-mono">24.5°N, 121.5°E</p>
                                </div>
                            </div>
                        </header>
                        <div className="flex-1 p-6 overflow-hidden">
                            {renderContent()}
                        </div>
                    </main>

                    {/* Modals */}
                    <Modal isOpen={isModalOpen} onClose={() => setIsModalOpen(false)} title={modalType === 'volunteer' ? '登錄新志工' : '新增後勤需求'}>
                        <form onSubmit={handleAddItem} className="space-y-4">
                            {modalType === 'volunteer' ? (
                                <>
                                    <div className="grid grid-cols-2 gap-4">
                                        <div><label className="block text-xs font-bold text-slate-500 mb-1">姓名</label><input name="name" required className="w-full border border-slate-300 rounded-lg p-2.5 text-sm focus:ring-2 focus:ring-blue-500 outline-none" placeholder="輸入全名" /></div>
                                        <div><label className="block text-xs font-bold text-slate-500 mb-1">聯絡電話</label><input name="phone" required className="w-full border border-slate-300 rounded-lg p-2.5 text-sm focus:ring-2 focus:ring-blue-500 outline-none" placeholder="09xx-xxx-xxx" /></div>
                                    </div>
                                    <div><label className="block text-xs font-bold text-slate-500 mb-1">專業技能</label><input name="skill" className="w-full border border-slate-300 rounded-lg p-2.5 text-sm focus:ring-2 focus:ring-blue-500 outline-none" placeholder="如：緊急救護 (EMT-1)" /></div>
                                </>
                            ) : (
                                <>
                                    <div><label className="block text-xs font-bold text-slate-500 mb-1">需求品項</label><input name="item" required className="w-full border border-slate-300 rounded-lg p-2.5 text-sm focus:ring-2 focus:ring-blue-500 outline-none" placeholder="如：睡袋" /></div>
                                    <div className="grid grid-cols-2 gap-4">
                                        <div><label className="block text-xs font-bold text-slate-500 mb-1">數量</label><input name="qty" type="number" className="w-full border border-slate-300 rounded-lg p-2.5 text-sm focus:ring-2 focus:ring-blue-500 outline-none" /></div>
                                        <div>
                                            <label className="block text-xs font-bold text-slate-500 mb-1">優先級</label>
                                            <select name="priority" className="w-full border border-slate-300 rounded-lg p-2.5 text-sm outline-none">
                                                <option>普通</option>
                                                <option>高</option>
                                                <option>緊急</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div><label className="block text-xs font-bold text-slate-500 mb-1">需求單位</label><input name="from" className="w-full border border-slate-300 rounded-lg p-2.5 text-sm focus:ring-2 focus:ring-blue-500 outline-none" placeholder="如：A區安置點" /></div>
                                </>
                            )}
                            <div className="pt-4 flex justify-end gap-3">
                                <button type="button" onClick={() => setIsModalOpen(false)} className="px-4 py-2 text-slate-500 font-bold text-sm hover:bg-slate-100 rounded-lg transition-colors">取消</button>
                                <button type="submit" className="px-6 py-2 bg-blue-600 text-white font-bold text-sm rounded-lg shadow-md hover:bg-blue-700 transition-colors">確認新增</button>
                            </div>
                        </form>
                    </Modal>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
